Search.setIndex({"docnames": ["CONCEPTS/data_parallelism", "CONCEPTS/dp/zero_algorithm", "CONCEPTS/parallel_context", "CONCEPTS/tensor_model_parallelism", "CONCEPTS/tp/1d_parallel_algorithm", "CONCEPTS/tp/2d_parallel_algorithm", "CONCEPTS/tp/2p5d_parallel_algorithm", "CONCEPTS/tp/3d_parallel_algorithm", "TUTORIALS/tensor_model_parallelism", "index"], "filenames": ["CONCEPTS/data_parallelism.md", "CONCEPTS/dp/zero_algorithm.md", "CONCEPTS/parallel_context.md", "CONCEPTS/tensor_model_parallelism.md", "CONCEPTS/tp/1d_parallel_algorithm.md", "CONCEPTS/tp/2d_parallel_algorithm.md", "CONCEPTS/tp/2p5d_parallel_algorithm.md", "CONCEPTS/tp/3d_parallel_algorithm.md", "TUTORIALS/tensor_model_parallelism.md", "index.rst"], "titles": ["Concept of Data Parallelism", "Zero Redundancy Optimizer DP", "Concept of Parallel Context", "Concept of Tensor Model Parallelism", "1D parallel algorithm (same as Megatron-LM)", "2D parallel (SUMMA) algorithm", "2.5D parallel (SUMMA-2.5) algorithm", "3D parallel Algorithm", "Tensor Model Parallelism Tutorial", "OSLO: Open Source for Large-scale Optimization"], "terms": {"author": [0, 1, 3, 4, 5, 6, 7, 8, 9], "jinwon": [0, 1], "kim": [0, 1], "i": [0, 1, 2, 4, 5, 6, 7, 8], "wide": 0, "us": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], "techniqu": [0, 1, 4, 7], "train": [0, 1, 3, 4, 9], "deep": [0, 1, 3], "learn": [0, 1, 3], "model": [0, 1, 4, 5, 6, 7, 9], "It": [0, 6], "involv": [0, 6, 7], "distribut": [0, 1, 2, 3, 4, 5], "across": [0, 1, 4], "multipl": [0, 3, 4, 6, 7, 8], "process": [0, 1, 2], "unit": 0, "gpu": [0, 4, 7, 8, 9], "each": [0, 1, 4, 6, 8], "which": [0, 1, 3, 6, 7, 8, 9], "ha": [0, 6, 7], "copi": 0, "paramet": [0, 3, 4, 5, 6, 7, 8], "The": [0, 1, 5, 6, 9], "divid": [0, 7], "subset": 0, "independ": 0, "comput": [0, 1, 4, 5, 6, 7], "gradient": 0, "its": [0, 1], "ar": [0, 1, 2, 5, 8, 9], "aggreg": 0, "updat": [0, 1], "thi": [0, 2, 5, 6, 7, 8], "approach": [0, 6], "enabl": 0, "effici": [0, 1, 3, 5, 8], "can": [0, 1, 2, 4, 5, 6, 8, 9], "acceler": 0, "larg": [0, 3, 4, 5, 7], "dataset": 0, "oslo": [0, 2, 4, 5, 6, 7, 8], "support": [0, 3, 8], "zero": 0, "redund": 0, "easili": [0, 9], "scale": [0, 4, 5], "dp": 0, "memori": [0, 1, 4, 5, 6, 7], "toward": 0, "trillion": 0, "paper": [1, 4, 5, 6, 7], "http": [1, 4, 5, 6, 7, 9], "arxiv": [1, 4, 5, 6, 7], "org": [1, 4, 5, 6, 7], "ab": 1, "1910": 1, "02054": 1, "data": [1, 2, 8, 9], "parallel": [1, 9], "remov": 1, "elimin": 1, "need": 1, "replic": 1, "turn": [1, 5], "reduc": [1, 4, 6, 7], "usag": 1, "commun": [1, 6, 7, 8], "overhead": 1, "dure": 1, "base": [1, 5, 6, 7, 9], "correspond": 1, "onli": [1, 8], "respons": 1, "those": 1, "after": 1, "reduct": 1, "releas": 1, "similar": [1, 2, 8], "store": 1, "associ": 1, "group": 2, "manag": [2, 9], "you": [2, 8, 9], "put": 2, "desir": 2, "class": 2, "There": [2, 8], "three": [2, 7, 8], "method": [2, 3, 8], "If": [2, 8, 9], "pytorch": [2, 8], "launcher": 2, "function": [2, 8], "from": [2, 4, 5, 6, 7, 8], "torch": [2, 4, 5, 6, 7, 8], "import": [2, 4, 5, 6, 7, 8], "parallelcontext": [2, 4, 5, 6, 7, 8], "parallel_context": [2, 4, 5, 6, 7, 8], "data_parallel_s": [2, 4, 5, 6, 7, 8], "tensor_parallel_s": [2, 4, 5, 6, 7, 8], "pipeline_parallel_s": [2, 4, 5, 6, 7, 8], "sequence_parallel_s": 2, "expert_parallel_s": 2, "slurm": [2, 8], "In": [2, 8], "case": 2, "must": [2, 8], "input": [2, 5, 6, 7], "host": 2, "port": [2, 8], "togeth": 2, "your_host": 2, "your_port": 2, "openmpi": 2, "an": [2, 3, 4, 8], "enum": 2, "name": [2, 8, 9], "parallelmod": [2, 4, 5, 6, 7, 8], "global_rank": 2, "get_local_rank": 2, "global": 2, "data_parallel_rank": 2, "tensor_parallel_rank": 2, "tensor": [2, 4, 5, 6, 7, 9], "pipeline_parallel_rank": 2, "pipelin": 2, "sequence_parallel_rank": 2, "sequenc": [2, 8], "expoert_parallel_rank": 2, "expert": 2, "global_s": 2, "get_world_s": 2, "expoert_parallel_s": 2, "kichang": [3, 4, 5, 6, 7, 8], "yang": [3, 4, 5, 6, 7, 8], "kevin": [3, 4, 5, 6, 7, 8], "ko": [3, 4, 5, 6, 7, 8], "make": [3, 8, 9], "possibl": [3, 8], "larger": [3, 8], "partit": [3, 4, 5, 8], "dimens": [3, 4, 7, 8], "we": [3, 8, 9], "1d": [3, 5, 6, 7], "2d": [3, 6, 7, 8], "2": [3, 4, 7, 9], "5d": [3, 7, 8], "3d": [3, 8, 9], "more": [3, 5, 6, 7, 8, 9], "same": [3, 8], "megatron": [3, 8], "lm": [3, 8], "summa": [3, 7, 8], "5": 3, "multi": 3, "billion": [3, 4], "languag": [3, 4], "super": 3, "dimension": 3, "maxim": 3, "huge": 3, "neural": [3, 7], "network": [3, 7], "minho": [3, 4, 5, 6, 7, 8], "ryu": [3, 4, 5, 6, 7, 8], "pdf": [4, 5, 6, 7], "1909": 4, "08053": 4, "weight": [4, 5, 6, 7], "devic": [4, 6, 7, 9], "load": [4, 5], "split": [4, 5, 6, 7, 8], "layer": [4, 5, 6, 7, 8], "smaller": [4, 6, 8], "chunk": 4, "along": [4, 5, 7], "one": [4, 7, 8], "them": 4, "among": [4, 7], "differ": [4, 8], "For": [4, 5, 8], "exampl": [4, 8], "linear": [4, 5, 6], "y": [4, 5], "xa": [4, 5], "column": [4, 5, 7, 8], "row": [4, 5, 7, 8], "fashion": 4, "A": [4, 5, 7], "a1": 4, "a2": 4, "y_i": 4, "xa_i": 4, "b": 4, "b1": 4, "b2": 4, "z": 4, "y1": 4, "y2": 4, "all": [4, 9], "oper": [4, 6], "cluster": [4, 7], "tensor_1d": [4, 8], "tensor_parallel_mod": [4, 5, 6, 7, 8], "should": [4, 5, 6, 7, 8], "divis": 4, "tp_size": [4, 5, 6, 7, 8], "defin": [4, 6, 7, 8], "section": [4, 6, 7, 8], "nn": [4, 5, 6, 7, 8], "tensorparallel": [4, 5, 6, 7, 8], "4": [4, 5], "tp_depth": [4, 5, 6, 7, 8], "1": [4, 5, 6, 7, 9], "from_torch": [4, 5, 6, 7, 8], "readi": [4, 5, 6, 7, 8], "2104": 5, "05343": 5, "lead": 5, "high": 5, "consumpt": 5, "becaus": [5, 8], "doe": 5, "activ": 5, "To": [5, 6], "address": [5, 6, 7], "issu": 5, "wa": [5, 6], "introduc": [5, 7], "evenli": 5, "instanc": 5, "when": [5, 9], "x": [5, 8], "four": 5, "sub": [5, 6, 7], "matric": [5, 6], "calcul": 5, "done": 5, "two": 5, "step": [5, 8], "broadcast": 5, "result": [5, 6], "matrix": [5, 6], "product": 5, "tensor_2d": [5, 8], "sinc": 5, "both": [5, 7], "squar": 5, "posit": [5, 7, 8], "integ": [5, 7], "2105": [6, 7], "14500": 6, "lower": [6, 8], "cost": [6, 7, 8], "than": [6, 8], "increas": 6, "propos": [6, 7], "appli": 6, "output": 6, "combin": 6, "other": 6, "tensor_2p5d": [6, 8], "recommend": [6, 8], "set": 6, "becom": 6, "ident": 6, "8": [6, 7, 8], "tensor_parallel_depth": [6, 8], "14450": 7, "have": [7, 8], "been": 7, "previous": 7, "challeng": 7, "pose": 7, "while": 7, "also": [7, 8], "final": 7, "further": 7, "har": 7, "capabl": 7, "singl": [7, 8], "design": 7, "limit": 7, "tensor_3d": [7, 8], "cubic": [7, 8], "unlik": 8, "simpli": 8, "launch": 8, "torchrun": 8, "nproc_per_nod": 8, "your_script": 8, "py": 8, "instal": 8, "your": 8, "environ": 8, "follow": 8, "work": [8, 9], "srun": 8, "num_gpu": 8, "inform": 8, "refer": 8, "document": 8, "deepspe": 8, "how": 8, "warn": 8, "assign": 8, "cpu": 8, "cuda": 8, "transform": [8, 9], "automodelforcausallm": 8, "autotoken": 8, "from_pretrain": 8, "gpt2": 8, "requir": 8, "just": 8, "call": 8, "here": 8, "explain": 8, "about": 8, "argument": 8, "total": 8, "num": 8, "power": 8, "e": 8, "g": 8, "16": 8, "number": 8, "type": 8, "detail": 8, "see": 8, "megatronlm": 8, "much": 8, "effect": 8, "between": 8, "mode": 8, "2p5d": 8, "Not": 8, "want": 8, "tensor_parallel": 8, "mix": 8, "pp": 8, "later": 8, "version": 8, "find": [8, 9], "concept": 8, "text": 8, "gener": 8, "addit": 8, "variou": [8, 9], "task": 8, "classif": 8, "mask": 8, "likewis": 8, "write": 8, "code": [8, 9], "don": 8, "t": 8, "lot": 8, "christma": 8, "thing": 8, "return_tensor": 8, "pt": 8, "print": 8, "decod": 8, "num_beam": 8, "batch_siz": 8, "seq_len": 8, "64": 8, "save_interv": 8, "50": 8, "train_step": 8, "100": 8, "adam": 8, "lr": 8, "3e": 8, "add": 8, "pad": 8, "batch": 8, "doesn": 8, "pad_token": 8, "eos_token": 8, "re": 8, "go": 8, "librari": 8, "hug": [8, 9], "face": [8, 9], "load_dataset": 8, "util": 8, "squad": 8, "context": [8, 9], "str": 8, "_": 8, "shuffl": 8, "true": 8, "enumer": 8, "zero_grad": 8, "input_batch": 8, "truncat": 8, "max_length": 8, "forward": [8, 9], "backward": 8, "loss": 8, "label": 8, "input_id": 8, "save_pretrain": 8, "so": 8, "Then": 8, "like": [8, 9], "pytorch_model_tp_": 8, "tp_rank": 8, "_pp_": 8, "pp_rank": 8, "_ep_": 8, "ep_rank": 8, "bin": 8, "local": 8, "path": 8, "save_directori": 8, "parallel_ckpt": 8, "statu": 8, "pass": 8, "merge_checkpoint": 8, "modifi": 8, "point": 8, "nnode": 8, "node_rank": 8, "master_addr": 8, "your_node_address": 8, "master_port": 8, "sbatch": 8, "file": 8, "run": 8, "sbatch_fil": 8, "sh": 8, "command": 8, "bash": 8, "job": 8, "jobnam": 8, "time": 8, "infinit": 8, "request": 8, "world_siz": 8, "note": 8, "gre": 8, "equal": 8, "ntask": 8, "per": 8, "mem": 8, "64gb": 8, "export": 8, "hostnam": 8, "scontrol": 8, "show": 8, "slurm_job_nodelist": 8, "head": 8, "n": 8, "count_nod": 8, "wc": 8, "l": 8, "python": 8, "And": 8, "framework": 9, "provid": 9, "technologi": 9, "featur": 9, "kernel": 9, "fusion": 9, "could": 9, "kei": 9, "easi": 9, "magic": 9, "compat": 9, "being": 9, "consid": 9, "de": 9, "facto": 9, "standard": 9, "nlp": 9, "field": 9, "look": 9, "democrat": 9, "significantli": 9, "decreas": 9, "difficulti": 9, "pip": 9, "packag": 9, "Be": 9, "care": 9, "core": 9, "pypi": 9, "project": 9, "creat": 9, "object": 9, "check": 9, "rank": 9, "world": 9, "size": 9, "level": 9, "algorithm": 9, "our": 9, "pleas": 9, "misc": 9, "titl": 9, "howpublish": 9, "url": 9, "github": 9, "com": 9, "eleutherai": 9, "year": 9, "2021": 9, "under": 9, "term": 9, "apach": 9, "0": 9, "copyright": 9, "2022": 9, "right": 9, "reserv": 9}, "objects": {}, "objtypes": {}, "objnames": {}, "titleterms": {"concept": [0, 2, 3, 9], "data": 0, "parallel": [0, 2, 3, 4, 5, 6, 7, 8], "optim": [0, 1, 8, 9], "level": [0, 1], "refer": [0, 3], "zero": 1, "redund": 1, "dp": 1, "state": 1, "partit": 1, "1": [1, 2, 8], "gradient": 1, "2": [1, 2, 6, 8], "paramet": 1, "3": [1, 2, 8], "context": 2, "creat": [2, 8], "object": 2, "from_torch": 2, "from_slurm": 2, "from_openmpi": 2, "check": 2, "devic": 2, "rank": 2, "world": 2, "size": 2, "easili": 2, "tensor": [3, 8], "model": [3, 8], "algorithm": [3, 4, 5, 6, 7, 8], "1d": 4, "same": 4, "megatron": 4, "lm": 4, "usag": [4, 5, 6, 7], "2d": 5, "summa": [5, 6], "5d": 6, "5": [6, 8], "3d": 7, "tutori": [8, 9], "tabl": 8, "content": 8, "0": 8, "distribut": 8, "launcher": 8, "infer": 8, "token": 8, "do": 8, "usual": 8, "train": 8, "initi": 8, "some": 8, "variabl": 8, "4": 8, "load": 8, "dataset": 8, "dataload": 8, "6": 8, "save": 8, "merg": 8, "checkpoint": 8, "appendix": 8, "multi": 8, "node": 8, "oslo": 9, "open": 9, "sourc": 9, "larg": 9, "scale": 9, "what": 9, "i": 9, "about": 9, "instal": 9, "document": 9, "administr": 9, "note": 9, "cite": 9, "licens": 9}, "envversion": {"sphinx.domains.c": 2, "sphinx.domains.changeset": 1, "sphinx.domains.citation": 1, "sphinx.domains.cpp": 8, "sphinx.domains.index": 1, "sphinx.domains.javascript": 2, "sphinx.domains.math": 2, "sphinx.domains.python": 3, "sphinx.domains.rst": 2, "sphinx.domains.std": 2, "sphinx.ext.intersphinx": 1, "sphinx.ext.todo": 2, "sphinx.ext.viewcode": 1, "sphinx": 57}, "alltitles": {"Concept of Data Parallelism": [[0, "concept-of-data-parallelism"]], "Optimizer-Level Parallel": [[0, "optimizer-level-parallel"]], "References": [[0, "references"], [3, "references"]], "Zero Redundancy Optimizer DP": [[1, "zero-redundancy-optimizer-dp"]], "Optimizer State Partitioning (Level 1)": [[1, "optimizer-state-partitioning-level-1"]], "Gradient Partitioning (Level 2)": [[1, "gradient-partitioning-level-2"]], "Parameter Partitioning (Level 3)": [[1, "parameter-partitioning-level-3"]], "Concept of Parallel Context": [[2, "concept-of-parallel-context"]], "1. Create Parallel Context object": [[2, "create-parallel-context-object"]], "1.1. from_torch": [[2, "from-torch"]], "1.2. from_slurm": [[2, "from-slurm"]], "1.3. from_openmpi": [[2, "from-openmpi"]], "2. Check device ranks and world sizes easily": [[2, "check-device-ranks-and-world-sizes-easily"]], "2.1. Ranks": [[2, "ranks"]], "2.2. World sizes": [[2, "world-sizes"]], "Tensor Model Parallelism Tutorial": [[8, "tensor-model-parallelism-tutorial"]], "Table of contents": [[8, "table-of-contents"]], "0. Distributed Launcher": [[8, "distributed-launcher"]], "1. Inference": [[8, "inference"]], "1.1. Create model and tokenizer": [[8, "create-model-and-tokenizer"]], "1.2. Parallelize the model": [[8, "parallelize-the-model"]], "1.2.1 Tensor Parallel Algorithms": [[8, "tensor-parallel-algorithms"]], "1.3. Do inference as usual": [[8, "do-inference-as-usual"]], "2. Training": [[8, "training"]], "2.1. Initialize some variables": [[8, "initialize-some-variables"]], "2.2. Create model, optimizer and tokenizer": [[8, "create-model-optimizer-and-tokenizer"]], "2.3. Parallelize the model": [[8, "id1"]], "2.4. Load dataset and create dataloader": [[8, "load-dataset-and-create-dataloader"]], "2.5. Do training as usual": [[8, "do-training-as-usual"]], "2.6. Save the parallelized model": [[8, "save-the-parallelized-model"]], "2.6.1. Merging Checkpoints": [[8, "merging-checkpoints"]], "Appendix. Multi-node Training": [[8, "appendix-multi-node-training"]], "OSLO: Open Source for Large-scale Optimization": [[9, "oslo-open-source-for-large-scale-optimization"]], "What is OSLO about?": [[9, "what-is-oslo-about"]], "Installation": [[9, "installation"]], "Documents": [[9, "documents"]], "CONCEPTS": [[9, null]], "TUTORIALS": [[9, null]], "Administrative Notes": [[9, "administrative-notes"]], "Citing OSLO": [[9, "citing-oslo"]], "Licensing": [[9, "licensing"]], "1D parallel algorithm (same as Megatron-LM)": [[4, "d-parallel-algorithm-same-as-megatron-lm"]], "Usage": [[4, "usage"], [5, "usage"], [6, "usage"], [7, "usage"]], "2D parallel (SUMMA) algorithm": [[5, "d-parallel-summa-algorithm"]], "2.5D parallel (SUMMA-2.5) algorithm": [[6, "d-parallel-summa-2-5-algorithm"]], "3D parallel Algorithm": [[7, "d-parallel-algorithm"]], "Concept of Tensor Model Parallelism": [[3, "concept-of-tensor-model-parallelism"]], "Tensor Parallel Algorithms": [[3, "tensor-parallel-algorithms"]]}, "indexentries": {}})